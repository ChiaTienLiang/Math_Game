<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="css/test.css">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="http://code.jquery.com/jquery-3.3.1.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <title>ThinKinG</title>
</head>

<body class="bo">
    <div class="row">
        <div class="col-lg-3  h-100">
            <ul style='list-style-type:decimal;'>
                <h3>遊戲指引:</h3>
                <li>此遊戲為個位數字1~9的算術遊戲</li>
                <li>左上方為玩家輸入數字之總和</li>
                <li>右上方為目前關卡以及答案</li>
                <li>只要與右方數字相同即可進入下一關</li>
            </ul>
            <ul style='list-style-type:square;'>
                <h3>注意事項:</h3>
                <li>每個按鈕只能按一次</li>
                <li>沒有先乘除後加減</li>
                <li>無法連續按多個數字或符號</li>
            </ul>
        </div>
        <div class="col-lg-9  h-100">
            <table id="tpscr">
                <tr>
                    <td colspan="3" id="level">LEVEL:</td>
                </tr>
                <tr>
                    <td id="screen"></td>
                    <td id="equal"></td>
                    <td id="answer"></td>
                </tr>
            </table>
            <div>
                <button id="gamestart">START</button>
                <button id="nextlevel">NEXT LEVEL</button>
            </div>
            <table>
                <tr id="num_row">
                </tr>
            </table>
            <table>
                <tr id="oper_row">
                </tr>
            </table>
            <div id="re">
                <button class="restart" id="restart" onclick="reset()">CLEAR</button>
                <button id="hint">HINT</button>
            </div>
        </div>
        <!-- <div class="col-lg-3  h-100">

        </div> -->
    </div>
    <script>
        var btnSound = new Audio("Soundeffect/pushing_a_key.mp3");
        var bingoSound = new Audio("Soundeffect/coin05.mp3");
        var clearSound = new Audio("Soundeffect/powerdown07.mp3");
        var mouseSound = new Audio("Soundeffect/mousein.mp3");
        var level = 1;
        var j = 0; //第一階段j=0，第二階段J=1以此類推，讓i+J增加一個數字跟符號
        var answer = 0;
        $("#level").text("LEVEL:" + level);
        var op;
        var numbutId = []; //存放ID用
        var opbutId = [];
        //==================系統亂術產生數字及運算符號==================

        $(function () {
            $("#nextlevel").hide();
            $("#gamestart").click(function () {
                $(this).hide();
                gameStart();
            });
        });


        function gameStart() {
            $("#equal").text("=");
            $("#oper_row").css("pointer-events", "none");
            $("#num_row").css("pointer-events", "auto");

            var ran_num = [];
            var oper = ["+", "–", "×"];
            var ran_oper = [];
            var a = 0;

            for (var i = 0; i < 3 + j; i++) { //亂數取1-9
                ran_num[i] = Math.ceil(Math.random() * 9);
                $("#num_row").append(
                    `<td><button class="num" id="num${ran_num[i]}-${a}" onclick="numClick('${ran_num[i]}-${a}')">${ran_num[i]}</button></td>`
                );
                numbutId[i] = `num${ran_num[i]}-${a}`; //存放每個數字按鈕的ID
                a++;
            }

            for (var i = 0; i < 2 + j; i++) { //亂數取運算符號
                ran_oper[i] = oper[Math.floor(Math.random() * 3)];
                $("#oper_row").append(
                    `<td><button class="oper" id="oper${ran_oper[i]}-${a}" onclick="opClick('${ran_oper[i]}-${a}')">${ran_oper[i]}</button></td>`
                );
                a++;
            }

            shuffle(ran_num); //呼叫亂數排列的function
            shuffle(ran_oper);
            console.log(ran_num); //偷看答案用
            console.log(ran_oper);
            answer = ran_num[0];
            for (i = 0; i < ran_oper.length; i++) {

                switch (ran_oper[i]) {
                    case "+":
                        answer += ran_num[i + 1];
                        break;
                    case "–":
                        answer -= ran_num[i + 1];
                        break;
                    case "×":
                        answer *= ran_num[i + 1];
                        break;
                }
            }
            $("#answer").text(answer);
        }

        function shuffle(arr) { //亂數排列數字跟符號再去運算
            var i, j, temp;
            for (i = arr.length - 1; i > 0; i--) {
                j = Math.floor(Math.random() * (i + 1));
                temp = arr[i];
                arr[i] = arr[j];
                arr[j] = temp;
            }
            return arr;
        };

        //=================下方計算玩家輸入=======================
        var total = 0;
        var temp = 0;

        function numClick(num) {
            $("#num_row").css("pointer-events", "none");
            $("#oper_row").css("pointer-events", "auto");
            console.log(op);
            btnSound.play();
            document.getElementById("screen").value = "";
            var temp_num = document.getElementById("num" + num);

            $(temp_num).attr("disabled", "disabled");
            $(temp_num).css({
                "background-color": "gray",
                "border": "3px solid gray",
            });
            document.getElementById("screen").value = document.getElementById("screen").value + num.substr(0, 1);
            firstNum = document.getElementById("screen").value;

            if (op == undefined) {
                total += Number(firstNum);
                $("#screen").text(total);
            } else {
                switch (op) {
                    case "+":
                        total = total + Number(firstNum);
                        break;
                    case "–":
                        total = total - Number(firstNum);
                        break;
                    case "×":
                        total = total * Number(firstNum);
                        break;
                    default:
                        total = total + Number(firstNum);
                        break;
                }
            }

            $("#screen").text(total);
            if (total == answer) {
                level++;
                $("#level").text("LEVEL:" + level);
                // message();
                nextLev();
            }
        };

        function opClick(str) {
            $("#oper_row").css({
                "pointer-events": "none",
                //NOTE:增加顏色變淡
            });
            $("#num_row").css("pointer-events", "auto");

            btnSound.play();
            op = str.substr(0, 1);
            console.log(op);
            var temp_oper = document.getElementById("oper" + str);
            $(temp_oper).attr("disabled", true);
            $(temp_oper).css({
                "background-color": "gray",
                "border": "3px solid gray",
            });
        }

        function reset() {
            clearSound.play();
            total = 0;
            op = "";
            $("#screen").text("");
            $("button").each(function () {
                $(this).attr("disabled", false); //按鈕恢復可以按
                $(this).css({ //按鈕樣式恢復
                    "background-color": "#0b0b0b",
                    "color": "#ffc400",
                    "border": "3px solid #D4A509"
                });
            });
            $("#num_row").css("pointer-events", "auto");
            $("#oper_row").css("pointer-events", "none");
            $("button").hover(function () { //按鈕hover恢復
                $(this).css({
                    "background-color": "#D4A509",
                    "color": "#fff",
                });
            }, function () {
                $(this).css({
                    "background-color": "#0b0b0b",
                    "color": "#ffc400",
                });
            });
        }
        $("#nextlevel").click(function () {
            $(this).hide();
            bingoSound.play();
            $("#oper_row").empty();
            $("#num_row").empty();
            total = 0;
            answer = 0;
            op = "";
            gameStart();
        });

        function nextLev() {
            if (level == 3) {
                j++;
            } else if (level == 5) {
                j++;
            } else if (level % 10 == 0) {
                j++;
            };
            $("#nextlevel").show();
            $("#equal").text("");
            $("#oper_row").empty();
            $("#num_row").empty();
            $("#screen").text("");
            $("#answer").text("");
        }


        $(document).keypress(function (event) {
            btnSound.play();
            // console.log(numbutId);
            var Evekey = event.keyCode;
            var temp_numID = [];
            // console.log(Evekey);
            // var numBot= document.getElementById("num"+substr(0,1));
            for (var i = 0; i < numbutId.length; i++) {
                temp_numID[i] = numbutId[i].substr(3, 1);
                if (Evekey == Number(temp_numID[i]) + 48) {

                    $("#" + numbutId[i]).attr("disabled", "disabled");
                    $("#" + numbutId[i]).css({
                        "background-color": "gray",
                        "border": "3px solid gray"
                    });
                    numbutId[i] = "";
                    break;
                }
                console.log(numbutId[i]);
            }
            num = Evekey - 48;
            console.log(num);
            return (num);
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous">
    </script>
</body>

</html>
